# WhatsApp Service Configuration Example (YAML)
# Copy this file to config.yaml and customize for your environment

# Server configuration
server:
  host: "0.0.0.0"
  port: 8080

# WhatsApp client configuration
whatsapp:
  db_path: "./data/whatsmeow.db" # WhatsApp protocol database (managed by whatsmeow library)
  qr_timeout: "2m"
  reconnect_delay: "5s"
  max_reconnects: 10
  message_rate_limit: 30 # messages per minute

# WebSocket configuration for API server connection
websocket:
  url: "ws://localhost:3000/ws/whatsapp"
  api_key: "" # API key for authenticating with Node.js API
  ping_interval: "30s"
  pong_timeout: "10s"
  reconnect_delay: "5s"
  max_reconnects: 0 # 0 = unlimited
  queue_size: 1000

# Logging configuration
log:
  level: "info" # debug, info, warn, error
  format: "json" # json or text

# Rate limiting configuration
ratelimit:
  enabled: true
  requests_per_second: 10.0
  burst_size: 20
  by_ip: true
  by_api_key: false
  cleanup_interval: "5m"
  max_age: "1h"

# CORS configuration
cors:
  allowed_origins:
    - "http://localhost:5173" # Vite dev server
    - "http://127.0.0.1:5173" # Vite dev server (127.0.0.1)
    - "http://localhost:3001" # Vite dev server (alternate port)
    - "http://127.0.0.1:3001" # Vite dev server (127.0.0.1)
    - "http://localhost:3000" # Production build
  allowed_methods:
    - "GET"
    - "POST"
    - "PUT"
    - "DELETE"
    - "OPTIONS"
  allowed_headers:
    - "Origin"
    - "Content-Type"
    - "Accept"
    - "Authorization"
    - "X-Request-ID"
    - "X-API-Key"
  expose_headers:
    - "X-Request-ID"
    - "X-RateLimit-Limit"
    - "X-RateLimit-Remaining"
    - "X-RateLimit-Reset"
  allow_credentials: true
  max_age: 3600 # 1 hour

# API Key authentication configuration
apikey:
  enabled: false # Enable API key authentication (disabled for initial setup)
  header: "X-API-Key"

# Metrics configuration
metrics:
  enabled: true
  path: "/metrics"
  namespace: "whatsapp"

# Circuit breaker configuration
circuitbreaker:
  enabled: true
  max_requests: 3
  interval: "60s"
  timeout: "30s"
  failure_threshold: 5
  success_threshold: 2

# Media storage configuration
media:
  base_path: "./data/media"
  base_url: "http://localhost:8080/media"
  max_file_size: 16777216 # 16MB in bytes

# Database configuration
database:
  driver: "sqlite" # sqlite or postgres
  dsn: "./data/application.db" # Application database (sessions, events, reactions, etc.)
  max_idle_conns: 10
  max_open_conns: 100
  conn_max_lifetime: "1h"
  log_level: "warn" # silent, error, warn, info

# Event storage configuration
events:
  enabled: false
  retention_days: 30 # 0 = keep forever
  cleanup_time: "02:00" # UTC time in HH:MM format
  cleanup_interval: "1h"
